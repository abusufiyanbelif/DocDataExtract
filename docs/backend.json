{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the DocuExtract application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Document": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Document",
      "type": "object",
      "description": "Represents a document uploaded and processed by the DocuExtract application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Document entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who uploaded the document. (Relationship: User 1:N Document)"
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time when the document was uploaded.",
          "format": "date-time"
        },
        "originalFilename": {
          "type": "string",
          "description": "The original filename of the uploaded document."
        },
        "extractedText": {
          "type": "string",
          "description": "The text extracted from the document."
        },
        "documentType": {
          "type": "string",
          "description": "Type of document (e.g., identity proof, billing, medical report).",
          "format": "string"
        }
      },
      "required": [
        "id",
        "userId",
        "uploadDate",
        "originalFilename",
        "extractedText",
        "documentType"
      ]
    },
    "IdentityProofDetails": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "IdentityProofDetails",
      "type": "object",
      "description": "Represents the extracted details from an identity proof document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the IdentityProofDetails entity."
        },
        "documentId": {
          "type": "string",
          "description": "Reference to the Document this identity proof data belongs to. (Relationship: Document 1:1 IdentityProofDetails)"
        },
        "name": {
          "type": "string",
          "description": "Name extracted from the identity document."
        },
        "address": {
          "type": "string",
          "description": "Address extracted from the identity document."
        },
        "idNumber": {
          "type": "string",
          "description": "ID number extracted from the identity document."
        }
      },
      "required": [
        "id",
        "documentId",
        "name",
        "address",
        "idNumber"
      ]
    },
    "BillingDetails": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BillingDetails",
      "type": "object",
      "description": "Represents the extracted details from a billing document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the BillingDetails entity."
        },
        "documentId": {
          "type": "string",
          "description": "Reference to the Document this billing data belongs to. (Relationship: Document 1:1 BillingDetails)"
        },
        "date": {
          "type": "string",
          "description": "Date on the bill.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Total amount on the bill."
        },
        "vendorInformation": {
          "type": "string",
          "description": "Information about the vendor."
        },
        "purchasedItems": {
          "type": "string",
          "description": "List of purchased items."
        }
      },
      "required": [
        "id",
        "documentId",
        "date",
        "amount",
        "vendorInformation",
        "purchasedItems"
      ]
    },
    "MedicalReportDetails": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MedicalReportDetails",
      "type": "object",
      "description": "Represents the extracted details from a medical report document.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MedicalReportDetails entity."
        },
        "documentId": {
          "type": "string",
          "description": "Reference to the Document this medical report data belongs to. (Relationship: Document 1:1 MedicalReportDetails)"
        },
        "diagnosticDetails": {
          "type": "string",
          "description": "Details of the diagnosis."
        },
        "diseaseInformation": {
          "type": "string",
          "description": "Information about the disease."
        },
        "keyFindings": {
          "type": "string",
          "description": "Key findings from the medical report."
        }
      },
      "required": [
        "id",
        "documentId",
        "diagnosticDetails",
        "diseaseInformation",
        "keyFindings"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Access is restricted to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}",
        "definition": {
          "entityName": "Document",
          "schema": {
            "$ref": "#/backend/entities/Document"
          },
          "description": "Stores documents uploaded by users. Each document includes the denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}/identityProofDetails/{identityProofDetailsId}",
        "definition": {
          "entityName": "IdentityProofDetails",
          "schema": {
            "$ref": "#/backend/entities/IdentityProofDetails"
          },
          "description": "Stores extracted identity proof details.  Parent document contains userId for access control.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            },
            {
              "name": "identityProofDetailsId",
              "description": "The unique identifier for the identity proof details."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}/billingDetails/{billingDetailsId}",
        "definition": {
          "entityName": "BillingDetails",
          "schema": {
            "$ref": "#/backend/entities/BillingDetails"
          },
          "description": "Stores extracted billing details.  Parent document contains userId for access control.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            },
            {
              "name": "billingDetailsId",
              "description": "The unique identifier for the billing details."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/documents/{documentId}/medicalReportDetails/{medicalReportDetailsId}",
        "definition": {
          "entityName": "MedicalReportDetails",
          "schema": {
            "$ref": "#/backend/entities/MedicalReportDetails"
          },
          "description": "Stores extracted medical report details. Parent document contains userId for access control.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "documentId",
              "description": "The unique identifier for the document."
            },
            {
              "name": "medicalReportDetailsId",
              "description": "The unique identifier for the medical report details."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure secure and scalable data management for the DocuExtract application. It emphasizes authorization independence and simplifies security rules by denormalizing authorization data and segregating data based on access control needs.\n\n*   **Users Collection (`/users/{userId}`):** Stores user profiles. Access is restricted to the user themselves.\n*   **Documents Collection (`/users/{userId}/documents/{documentId}`):** Stores documents uploaded by users. Each document is a subcollection of a specific user, enforcing ownership. The `userId` is explicitly included within each document to ensure Authorization Independence. This allows for direct and secure rules based on user ownership without needing to traverse to the parent.\n*   **IdentityProofDetails, BillingDetails, MedicalReportDetails Subcollections (`/users/{userId}/documents/{documentId}/identityProofDetails/{identityProofDetailsId}`, `/users/{userId}/documents/{documentId}/billingDetails/{billingDetailsId}`, `/users/{userId}/documents/{documentId}/medicalReportDetails/{medicalReportDetailsId}`):** These collections store the extracted details for each document type. They are subcollections of documents owned by the user. Each document details entity contains `documentId` for reverse lookup to document, with document residing in `/users/{userId}/documents/{documentId}`. This approach enables implementing security rules to ensure only the owner can access these details.\n\n**Authorization Independence:**\n\nAuthorization Independence is achieved by denormalizing the `userId` into the `documents` collection. This eliminates the need for `get()` calls in the security rules to verify ownership, enabling atomic operations and improving performance. Security rules can directly check `request.auth.uid == resource.data.userId`.\n\n**QAPs (Rules are not Filters):**\n\nThe structure supports secure `list` operations by leveraging the hierarchical structure and ownership model. Listing documents is always performed within the context of a specific user (`/users/{userId}/documents`). Security rules can easily filter based on `request.auth.uid == userId`, ensuring users can only list their own documents. Similar filtering is enforced for the subcollections (`IdentityProofDetails`, `BillingDetails`, and `MedicalReportDetails`), which are accessed via parent document ID."
  }
}